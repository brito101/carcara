const urlChat=$("#chat-component").data("url"),unreadMessages=$("#unread-messages"),contactsList=$("#contacts-list"),messagesBox=$("#messages-box");let receiver=$("#receiver"),activeContact=$("#activeContact"),scrollFlag=!1,users=[],messages=[];$("#button-message-open").on("click",(function(a){$("#message-icon").hasClass("fa-plus")&&$.ajax({type:"GET",url:urlChat+`/read?contact=${receiver.val()}`})}));let lastScrollTop=0;function scrollBox(){messagesBox.animate({scrollTop:999999999},"slow")}function updateChat(){0==scrollFlag&&scrollBox(),$.ajax({type:"GET",url:urlChat+`?contact=${receiver.val()}`,success:function(a){unreadMessages.text(a.unreadMessages),activeContact.text(a.name),users=a.users,messages=a.messages.reverse();let e="";users.forEach((a=>{e+=`<li onClick="changeReceiver(${a.id});">\n                                <a href="#"><img class="direct-chat-img" src="${a.photo}" alt ="${a.name}">\n                                    <div class="contacts-list-info">\n                                        <span class="contacts-list-name">${a.name} <i class="fa fa-circle ${a.active}"></i>\n                                            <small class="contacts-list-date float-right">${a.lastMessage.date}</small>\n                                        </span>\n                                        <span class="contacts-list-msg">${a.lastMessage.message}</span>\n                                </div>\n                            </li>`})),contactsList.html(e);let s="";receiver.val(a.lastContact),messages.forEach((a=>{messagesBox.data("me")==a.sender_id?s+=`<div class="direct-chat-msg">\n                                    <div class="direct-chat-infos clearfix">\n                                        <span class="direct-chat-name float-left">${a.sender.name}</span>\n                                        <span class="direct-chat-timestamp float-right">${a.created_at}</span>\n                                    </div>\n                                    <img class="direct-chat-img" src="${a.senderPhoto}" alt="${messagesBox.data("name")}">\n                                    <div class="direct-chat-text">${a.message}</div>\n                            </div>`:s+=`<div class="direct-chat-msg right">\n                                <div class="direct-chat-infos clearfix">\n                                    <span class="direct-chat-name float-right">${a.sender.name}</span>\n                                    <span class="direct-chat-timestamp float-left">${a.created_at}</span>\n                                </div>\n                                <img class="direct-chat-img" src="${a.senderPhoto}"" alt="${a.sender.name}">\n                                <div class="direct-chat-text">${a.message}</div>\n                            </div>`})),messagesBox.html(s)},error:function({status:a,statusText:e}){console.log(a,e)}})}messagesBox.on("scroll",(function(a){let e=$(a.currentTarget).scrollTop();scrollFlag=!(e>lastScrollTop),lastScrollTop=e})),updateChat();const chatInterval=setInterval((()=>{updateChat()}),3e3);function changeReceiver(a){receiver.val(a),$('*[data-widget="chat-pane-toggle"]').click(),updateChat()}$('*[data-card-widget="remove"]').on("click",(function(){clearInterval(chatInterval)})),$("#chat").on("submit",(function(a){a.preventDefault(),scrollFlag=!1,scrollBox(),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:$("#chat").attr("action"),data:$(this).serialize(),success:function(a){$("#chat-text").val(""),updateChat()}})}));
